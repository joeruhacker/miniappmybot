<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Мини-Магазин</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .product { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        .cart { margin-top: 20px; }
        button { padding: 10px 20px; }
    </style>
</head>
<body>
    <h1>Магазин цифровых товаров</h1>
    <div class="product" data-name="Робуксы" data-price="100">
        <h2>Робуксы</h2>
        <p>Цена: 100 руб.</p>
        <input type="number" min="1" value="1" class="quantity">
        <button onclick="addToCart(this)">Добавить в корзину</button>
    </div>
    <div class="product" data-name="Айтюнс карты" data-price="100">
        <h2>Айтюнс карты</h2>
        <p>Цена: 100 руб.</p>
        <input type="number" min="1" value="1" class="quantity">
        <button onclick="addToCart(this)">Добавить в корзину</button>
    </div>
    <div class="cart">
        <h2>Корзина</h2>
        <ul id="cart-items"></ul>
        <button onclick="sendOrder()">Отправить заказ</button>
    </div>

    <script>
        let cart = [];

        function addToCart(button) {
            const productDiv = button.parentElement;
            const name = productDiv.getAttribute('data-name');
            const price = parseFloat(productDiv.getAttribute('data-price'));
            const quantity = parseInt(productDiv.querySelector('.quantity').value);

            const existingItem = cart.find(item => item.name === name);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({ name, price, quantity });
            }

            renderCart();
        }

        function renderCart() {
            const cartItems = document.getElementById('cart-items');
            cartItems.innerHTML = '';
            cart.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.name} - ${item.quantity} шт. - ${item.price * item.quantity} руб.`;
                cartItems.appendChild(li);
            });
        }

        function sendOrder() {
            if (cart.length === 0) {
                alert('Корзина пуста!');
                return;
            }

            const cartData = JSON.stringify(cart);

            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                Telegram.WebApp.sendData(cartData);
            } else {
                alert('Ошибка: Мини-приложение должно быть открыто в Telegram!');
            }
        }

        window.onload = function() {
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                Telegram.WebApp.ready();
            } else {
                alert('Ошибка: Мини-приложение должно быть открыто в Telegram!');
            }
        };
    </script>
</body>
</html>
